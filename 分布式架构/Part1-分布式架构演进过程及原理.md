文章内容来源：
> 1.《分布式服务架构原理、设计与实战》- 李艳鹏，杨彪  （文章结构和大多内容源自此处）

> 2.《架构即未来》  （AKF拆分原则来自此处）

参阅网页链接：

> 1.https://www.jianshu.com/p/92ca0bfbd52f （单体架构,SOA架构,微服务架构,分布式架构,集群架构)
>
> 2.https://blog.csdn.net/qq_42332821/article/details/103277262 
>
> 3.https://blog.csdn.net/weixin_40751299/article/details/83181582
>
> 4.http://blog.sina.com.cn/s/blog_493a84550102z8pw.html (单体到微服务划分大原则)



## 一、 传统单体架构
 *  定义：  一个应用中包含了应用程序所有的功能(比如：页面、代码、配置等)把应用程序打包成war包、jar包部署到服务器中，通常称之为单体架构。

### 单体架构图：

   ![单体架构图](./part1_imgs/单体架构图.jpg)
  
### 单体架构的演进：

  * 3.1  J2EE/JEE

  * 3.2  SSH

  * 3.3  从JEE到SSH的发展史：

     * 2000~2001年 Craig 觉得web层可以使用MVC框架使该层开发更加容易，于是就有了 Struts，这一步是对原来规范的很好实现，并没有产生质的突破；
     * 2001~2003年 Gavin 觉得EJB连接数据的部分有待改进，于是就有了Hibernate，Hibernate并没有被规范束缚，而是想怎么改就怎么改；                
     * 2002年左右 html + CSS + JS 也开始渐渐分离；
     * 2002~2004年 Rod 觉得类和类之间的依赖关系应该改善，于是就有了Spring，Spring是为了让 javaEE 规范更加易用，因此对其进行了大刀阔斧的改造。在当时看绝对是取其精华，去其糟粕。

### 单体架构优缺点分析：

  * 优点： 
    * 便于共享； 
    * 便于测试；
    * 便于部署；

  * 缺点： 
    * 复杂性高；
    * 技术债务逐渐上升；
    * 构建和部署速度逐渐变慢；
    * 扩展能力受限，无法按需伸缩；
    * 阻碍技术创新；

        

## 二、服务化架构（SOA）

### 2.1 定义：

### 2.2 SOA 的实现方式：

   *  Web Service:

       *  工作原理图：![WebService](./part1_imgs/WebService.jpg)
                           
       *  涉及到的技术说明及原理：

             WSDL:

             UDDI:

             SOAP:

       *  进一步演进出来了技术形态：

             Rest + Http + Json

   *  ESB(总线型)：

       * 工作原理图：工作原理图：![ESB](./part1_imgs/ESB.jpg)

       *  设计到的技术说明及原理：

### 2.3 服务化架构的优缺点分析：



## 三、微服务架构

###  微服务架构的产生：

###  对比：

   *  微服务架构与传统单体架构的对比：

   *  微服务架构与SOA服务化的对比：

### 微服务的去中心化治理

### 微服务的交互模式

   * 读者容错模式
       * 定义: 指微服务化中服务提供者和消费者之间如何对接口的改变进行容错。
          
       * 要求:  消费者需要对提供者提供的功能进行兼容性设计， 尤其对服务提供者返回的内容进行兼容，或者解决在服务提供者改变接口或者数据格式的情况下，如何让服务消费者正常运行；
                  
       * 案例：
           * 消费者处理服务提供者返回的内容时， 只提取自己需要的内容，抛弃其它内容；
           * 服务接口定义时， 参数可以使用枚举值， 返回值的DTO中禁止使用枚举值；
              
   * 消费者驱动模式

   * 去数据共享模式
       * 微服务架构领域， 微服务间的交互通过定义良好的接口来实现，不要使用共享数据来实现。
       
       * 图解：
            
            ![业务调用依赖数据库](./part1_imgs/业务调用依赖数据库.jpg)
       
       * 缺点:
         * 使得微服务间交互除了依赖接口契约， 还依赖存储契约
         * 上游数据格式发生改变， 可能导致下游的处理逻辑出现问题
         * 多个服务共享一个资源服务， 导致对资源服务的运维难以划清责任和界限
         * 跨机房的服务调用不能使用独立的资源部署模式，难以实现服务自治

### 微服务的分解和组合模式
* 服务代理模式

    * 架构图：

        ![服务代理模式](./part1_imgs/服务代理模式.jpg)
        
    * 代理的职责      
        * 统一入口
        * 鉴权
        * 请求过滤
        
    * 案例      
        * 服务网关
        

* 服务聚合模式

    * 架构图：

       ![服务聚合模式](./part1_imgs/服务聚合模式.jpg)
       
    * 案例
        * 报表服务

* 服务串联模式

    * 架构图：

        ![服务串联模式](./part1_imgs/服务串联模式.jpg)
        
     * 原理及特点分析：
        
         这种模式在接收到请求后会产生一个经过合并的响应，在这种情况下，服务1接收到请求后会与服务B进行通信，类似地，服务2会同服务3进行通信。所有服务都使用同步消息传递。在整个链式调用完成之前，客户端会一直阻塞。因此，服务调用链不宜过长，以免客户端长时间等待
 
 * 服务分支模式

      * 原理及特点分析：

      * 架构图

        ![服务分支模式](./part1_imgs/服务分支模式.jpg)

      * 使用分支模式对可用性的影响举例：

* 服务异步消息模式

    * 架构图

        ![服务异步消息模式](./part1_imgs/服务异步消息模式.jpg)
        
    * 分析:
        虽然REST设计模式非常流行，但它是同步的，会造成阻塞。因此部分基于微服务的架构可能会选择使用消息队列代替REST请求/响应, 尤其是对于非核心业务。
        
    * 案例
    
        * 处理订单后，发送短信
        
* 服务共享数据模式

    * 架构图
    
        ![服务共享数据模式](./part1_imgs/服务共享数据模式.jpg)
        
    * 分析：
        自治是微服务的设计原则之一，就是说微服务是全栈式服务。但在重构现有的“单体应用（monolithic application）”时，SQL数据库反规范化可能会导致数据重复和不一致。因此，在单体应用到微服务架构的过渡阶段，可以使用这种设计模式
        
&nbsp;
&nbsp;

### 微服务的容错模式

   *  舱壁隔离模式

       * 微服务容器分组

       * 线程池隔离

   * 熔断模式

        * 熔断模式的状态流转图：

           ![熔断模式的状态流转图](./part1_imgs/熔断模式的状态流转图.jpg)

### 限流模式

   * 计数器

       * 原理： 通过原子变量计算单位时间内的访问次数， 如果超出某个阈值， 则拒绝后续的请求， 等到下一个时间单位再重新计数；
       * 实例分析：

   * 令牌桶

        * 原理： 通过一个线程在单位时间内产生固定数量的令牌， 然后把令牌放入队列， 每次请求调用需要从桶中拿取一个令牌， 拿到令牌后才有资格执行请求调用， 否则只能等待拿到令牌再执行，或者直接丢弃；
                   
   * 信号量

        * 原理： 类似于java中的 Semaphore

### 失效转移模式

   * 若微服务架构中发生了熔断和限流， 该如何处理被拒绝的请求？ 解决这个问题的模式叫做失效转移模式， 通常分为下面几种：

      * 快速失败策略， 即直接返回错误给调用方；

      * 如果有备份，则迅速切换到备份服务；

      * 重试机制；

### 微服务的粒度 
   * 微服务的拆分不是越细越好。 倡导对微服务的拆分适可而止，原则是拆分到可以让使用方自由地编排底层的子服务来获得相应的组合服务即可，同时要考虑团队的建设及人员的数量和分配等。


## 四、服务化管理和治理框架的技术选型
      
   * RPC

   * 服务化

   * 微服务
   

   



   